{
    "version": "Notebook/1.0",
    "items": [
        {
            "type": 1,
            "content": {
                "json": "## SOC Operations & Workspace Health Dashboard\n\nThis dashboard is designed for SOC managers and engineers to monitor the health of the Microsoft Sentinel workspace. It tracks data ingestion volume to catch anomalies (spikes/drops), monitors the \"pulse\" of critical tables to ensure logs are arriving, and identifies failed analytic rules or silent data connectors."
            },
            "name": "text - overview"
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "parameters": [
                    {
                        "id": "timeRange",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRange",
                        "type": 4,
                        "description": "Select the timeframe for analysis.",
                        "isRequired": true,
                        "value": {
                            "durationMs": 86400000
                        },
                        "typeSettings": {
                            "selectableValues": [
                                {
                                    "durationMs": 3600000
                                },
                                {
                                    "durationMs": 14400000
                                },
                                {
                                    "durationMs": 43200000
                                },
                                {
                                    "durationMs": 86400000
                                },
                                {
                                    "durationMs": 172800000
                                },
                                {
                                    "durationMs": 259200000
                                },
                                {
                                    "durationMs": 604800000
                                },
                                {
                                    "durationMs": 1209600000
                                },
                                {
                                    "durationMs": 2419200000
                                },
                                {
                                    "durationMs": 2592000000
                                },
                                {
                                    "durationMs": 5184000000
                                },
                                {
                                    "durationMs": 7776000000
                                }
                            ]
                        },
                        "timeContext": {
                            "durationMs": 86400000
                        }
                    }
                ],
                "style": "pills",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - time"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "search in (Heartbeat, SigninLogs, AzureActivity, SecurityEvent) *\n| summarize LastLog = max(TimeGenerated) by $table\n| extend HealthStatus = iff(LastLog > ago(1h), \"✅ Healthy\", \"⚠️ Lagging\")\n| order by LastLog asc",
                "size": 3,
                "title": "\"The Pulse\" - Last Log Received for Critical Tables",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "HealthStatus",
                            "formatter": 18,
                            "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                    {
                                        "operator": "==",
                                        "thresholdValue": "✅ Healthy",
                                        "representation": "green",
                                        "text": "{0}"
                                    },
                                    {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "orange",
                                        "text": "{0}"
                                    }
                                ]
                            }
                        }
                    ]
                }
            },
            "name": "query - the pulse"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "Usage\n| where TimeGenerated {TimeRange}\n| summarize DailyMB = sum(Quantity) / 1024 by DataType, bin(TimeGenerated, 1d)\n| render timechart",
                "size": 0,
                "title": "Data Ingestion Volume (GB) by Table",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "visualization": "timechart"
            },
            "name": "query - ingestion volume"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SentinelHealth\n| where TimeGenerated {TimeRange}\n| where Status != \"Success\"\n| summarize count() by SentinelResourceName, Description, Status",
                "size": 3,
                "title": "Silent Data Connectors (Failures/Warnings)",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "Status",
                            "formatter": 18,
                            "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                    {
                                        "operator": "==",
                                        "thresholdValue": "Failure",
                                        "representation": "red",
                                        "text": "{0}"
                                    },
                                    {
                                        "operator": "==",
                                        "thresholdValue": "Warning",
                                        "representation": "yellow",
                                        "text": "{0}"
                                    },
                                    {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "orange",
                                        "text": "{0}"
                                    }
                                ]
                            }
                        }
                    ]
                }
            },
            "name": "query - silent connectors"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SentinelHealth\n| where TimeGenerated {TimeRange}\n| where OperationName == \"Data fetch for analytics rule\"\n| where Status == \"Failure\"\n| project TimeGenerated, SentinelResourceName, Description, ExtendedProperties",
                "size": 3,
                "title": "Failed Analytic Rules",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "visualization": "table"
            },
            "name": "query - failed analytic rules"
        }
    ],
    "fallbackResourceIds": [
        "Azure Monitor"
    ],
    "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}